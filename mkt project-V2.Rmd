---
title: "Marketing Analytics Project: Black Friday"
author: "Weicheng Zhang, Zilei Zhang, Maura Oray, Gloria Zheng"
output:
  html_document:
    df_print: paged
---

1. Introduction 
Objective:
* Look at the distribution of customer demographics
* Determine which variables are highly correlated with purchase
* Identify which products are high-selling

The dataset comes from a competition hosted by Analytics Vidhya.

Group Github url: https://github.com/MauraO/Marketing-Analytics-Project
```{r message=FALSE, warning=FALSE}
#Load libraries
library(VIM)
library(readr)
library(tidyverse)
library(dplyr)
library(ggthemes)
library(devtools)
devtools::install_github('cttobin/ggthemr')
library(ggthemr)

BF <- read_csv("BlackFriday.csv")
```
2. Data Description
a. Describe the conceptual measure types of the different variables

* User_ID: discrete, nominal
* Product_ID: discrete, nominal
* Gender: discrete, nominal
* Age: discrete, ordinal
* Occupation: discrete, nominal
* City_Category: discrete, nominal
* Stay_in_Current_City_Years: continuous, ratio
* Marital_Status: discrete, nominal
* Product_Category_1: discrete, nominal
* Product_Category_2: discrete, nominal
* Product_Category_3: discrete, nominal
* Purchase: continuous, ratio

b. Mention all the steps you took to clean the data
Step 1. Check if the data contains missing values
```{r message=FALSE, warning=FALSE}
sum(complete.cases(BF))
aggr(BF,cex.axis = .4) #164,278 NA values
BF$Product_Category_2[is.na(BF$Product_Category_2)]<- 0 #0 - means the category_2 is missing
BF$Product_Category_3[is.na(BF$Product_Category_3)]<- 0 #0 - means the category_3 is missing

```
In the above visualization, we wanted to see which variables had the most NA values. We saw that the NA values were only concentrated in Product Category 2 and Product Category 3.

Step 2. Check the structure of the data
```{r message=FALSE, warning=FALSE}
summary(BF)
str(BF)
```
Step 3. Type coercion
```{r message=FALSE, warning=FALSE}
BF[1:11] = lapply(BF[1:11], factor)
```
The majority of the variables were either integers or characters. We decided to coerce the variables into factors (all except purchase) because the majority of them are categorical. 

Step 4. Tidy the data
```{r message=FALSE, warning=FALSE}
#Demographic data
demo = BF %>% 
  select(-starts_with("Product")) %>%
  group_by(User_ID) %>%
  mutate(Purchase = sum(Purchase))

#5891 unique customers

demo = demo[!duplicated(demo$User_ID), ]
```
> ### 3. Summary statistics and Data Visualizations  
** Customer Demographics**  
* Table 1. The distribution of Gender and Maritial Status  

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Two way frequency table showing different combination of customers using gender and marital status  
customer = table(demo$Gender, demo$Marital_Status)
colnames(customer) = c("Unmarried", "Married")
rownames(customer) = c("Female", "Male")

addmargins(customer)
addmargins(prop.table(customer))
```

The two-way frequency table shows 4 combinations of customers. There are 5891 distinct customers in total, and 2470 of them are unmarried males; 1755 are married males; 947 are unmarried females; 719 are married females.  
In this two-way frequency table, we can deduce that there are more unmarried customers (58%) than married (42%) and more male customers (72%) than female (28%). Therefore, in the following analyses regarding gender and marital status, we will focus on customers' average purchase amount instead of the sum purchase, because the sum purchase will easily be influenced by the number of people, which may cause a biased conclusion. 

* Plot 1. Distribution of Purchase
```{r echo=TRUE, message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(Purchase)) +
  geom_histogram(fill = "#014d64") +
  scale_x_continuous(limits = c(0, 11000000)) +
  theme_economist(base_size=14)+
  scale_fill_economist()+
  labs(x = "Purchase in Dollar", y = "Number of Customers", title = "Distribution of Purchase")
```

* Plot 2. Purchase Distribution by Gender and City
```{r message=FALSE, warning=FALSE}
ggthemr('flat dark')
demo %>%
  ggplot(aes(x = Purchase, fill = Gender)) +
  geom_histogram() +
  facet_wrap(~City_Category) +
  scale_x_continuous(limits = c(0, 3000000)) +
  labs(x = "Purchase in Dollar", y = "Number of Customers", title = "Purchase Distribution by Gender and City")+
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
```

* Plot 3. Purchase Distribution by Occupation
```{r}
ggthemr_reset()
demo %>%
  group_by(Occupation)%>%
  ggplot(aes(x = fct_infreq(Occupation), y = sum(Purchase), fill = Marital_Status)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  coord_flip() +
  labs(x = "Occupation", y = "Purchase in Dollar", title = "Purchase Distribution by Occupation")
```

* Plot 4. Purchase Distribution by Age
```{r}
ggthemr('sky')
demo %>%
  ggplot(aes(x = Age, y = Purchase)) +
  geom_boxplot() +
  labs(x = "Age", y = "Purchase in Dollar", title = "Purchase Distribution by Age")
```

* Plot 5. Purchase distribution by Gender
```{r message=FALSE, warning=FALSE}
ggthemr('dust',type = "outer")
demo %>%
  ggplot(aes(x = Purchase, fill = Gender)) +
  geom_histogram()+
  scale_x_continuous(limits = c(0, 3000000)) +
  labs(x = "Purchase in Dollar", y = "Number of Customers", title = "Purchase Distribution by Gender")
```

* Plot 6. Purchase distribution by stay in city years
```{r message=FALSE, warning=FALSE}
ggthemr('sea', layout = 'minimal')
demo %>%
  ggplot(aes(x = Stay_In_Current_City_Years, y = Purchase)) +
  geom_boxplot()+
  labs(x = "Stay in Current City Years", y = "Purchase", title = "Purchase Distribution by Stay Years")
```

* Plot 7. The most popular product category
The product category 1 has three of the most popular products: 5, 1 and 8 
```{r, echo=TRUE, message=FALSE, warning=FALSE}
ggthemr('light', layout = 'clean')
BF_prt = BF %>%
  group_by(Product_ID) %>%
  mutate(sumpp = sum(Purchase), avgpp = mean(Purchase))
BF_prt = BF_prt[-c(3:8)]
BF_prt%>%
  ggplot(aes(x = Product_Category_1))+
  geom_bar(aes(x = fct_infreq(as.factor(Product_Category_1))))+
  labs(x ="Product Category" , y = "Purchase Number", title = "The Distribution of Product Category")
  
```

4. Preliminary statistical analyses
**Do men spend more money on Black Friday than women?**
```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Independent t-test
t.test(demo[demo$Gender == "M", ]$Purchase,
       demo[demo$Gender == "F", ]$Purchase,
       paired = FALSE,
       alternative = "greater")
```
Because we want to figure out whether the gender influence the purchase. In table 1 and plot 2, we find that there are more male than female and male have more purchase than female. Therefore, we want to use an independent t-test to test whether it is significant.   
Based on the evidence from this data set and the result from t-test(p-value < 2.2e-16), we think the probability that male have same mean purchase as female is less than 5%, and the probability that male have larger mean purchase than female is bigger than 95%. Therefore, we reject the null hypothesis: the male have the same mean purchase as female, and accept the alternative hypothesis: Male have larger mean purchase than female. Moreover, from the sample, we can get the estimated mean purchase of male and female: 911963.2 and 699054.0

**Do unmarried customers spend more money on Black Friday than married?**
```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Independent t-test
t.test(demo[demo$Marital_Status == 0, ]$Purchase,
       demo[demo$Marital_Status == 1, ]$Purchase,
       paired = FALSE,
       alternative = "greater")
```
Because we want to figure out whether the maritial status influence the purchase. In table 1 and plot 3, we find that there are more unmarritial people than maritial people and unmaritial customers seem to have more purchase than maritial customers. Therefore, we want to use an independent t-test to test whether it is significant.  
Based on the evidence from this data set and the result from t-test(p-value = 0.056), we think the probability that unmaritial customers have same mean purchase as maritial customers is bigger than 5% but less than 10% , and the probability that unmaritial customers have larger mean purchase than maritial customers is less than 95% but bigger than 90%. Therefore, in 95% confidential level, we can not reject the null hypothesis: the unmatitial customers have the same mean purchase as maritial customers, but in 90% confidential level, we can reject it and accept the alternative hypothesis: unmaritial customers have larger mean purchase than maritial customers.

**Is there an association between City and purchase?**
```{r}
# Chi square test
# Creat purchase category
A1 = quantile(demo$Purchase, c(0.33,0.66))
A1
demo = demo %>% 
  mutate(purchase_category = cut(Purchase, breaks = c(-Inf, 304987.6, 826809.6, Inf),
  labels = c("City A", "City B", "City C")))

# Creat two way frequency table
table(demo$City_Category, demo$purchase_category)

# Apply chi square test
chisq.test(table(demo$Age, demo$purchase_category))
```
Because we want to figure out whether the cities customers stay in will influence purchase. In Plot 2, we find that there may exist difference in purchase distribution of the three cities. Therefore, we want to use a Chi-test to see whether this finding is significant.  
Based on the evidence from this data set and the result from Chi-test(p-Value < 2.2e-16), we think the probability that there is no difference among three cities is less than 5%, and the probability that there exists difference among three cities is bigger than 95%. Therefore, we reject the null hypothesis, and accept the alternative hypothesis: there exists difference in purchase distribution of the three cities. Therefore, from this data set, we draw the conclusion that there is an association between the city customers live in and purchase. 
