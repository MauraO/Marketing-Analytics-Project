---
title: "Marketing Analytics Project: Black Friday"
author: "Weicheng Zhang, Zilei Zhang, Maura Oray, Gloria Zheng"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```
1. Introduction 
Objective:
* Look at the distribution of customer demographics
* Determine which variables are highly correlated with purchase
* Identify which products are high-selling and the characteristics of their customers

The dataset comes from a competition hosted by Analytics Vidhya.

Group Github url: https://github.com/MauraO/Marketing-Analytics-Project
```{r message=FALSE, warning=FALSE}
#Load libraries
library(VIM)
library(readr)
library(tidyverse)
library(dplyr)

BF <- read_csv("BlackFriday.csv")
```
2. Data Description
a. Describe the conceptual measure types of the different variables

* User_ID: discrete, nominal
* Product_ID: discrete, nominal
* Gender: discrete, nominal
* Age: discrete, ordinal
* Occupation: discrete, nominal
* City_Category: discrete, nominal
* Stay_in_Current_City_Years: continuous, ratio
* Marital_Status: discrete, nominal
* Product_Category_1: discrete, nominal
* Product_Category_2: discrete, nominal
* Product_Category_3: discrete, nominal
* Purchase: continuous, ratio

b. Mention all the steps you took to clean the data
Step 1. Check if the data contains missing values
```{r message=FALSE, warning=FALSE}
sum(complete.cases(BF))
aggr(BF,cex.axis = .4) #164,278 NA values
BF$Product_Category_2[is.na(BF$Product_Category_2)]<- 0 #0 - means the category_2 is missing
BF$Product_Category_3[is.na(BF$Product_Category_3)]<- 0 #0 - means the category_3 is missing

```
In the above visualization, we wanted to see which variables had the most NA values. We saw that the NA values were only concentrated in Product Category 2 and Product Category 3.

Step 2. Check the structure of the data
```{r message=FALSE, warning=FALSE}
summary(BF)
str(BF)
```
Step 3. Type coercion
```{r message=FALSE, warning=FALSE}
BF[1:11] = lapply(BF[1:11], factor)
```
The majority of the variables were either integers or characters. We decided to coerce the variables into factors (all except purchase) because the majority of them are categorical. 

Step 4. Tidy the data
```{r message=FALSE, warning=FALSE}
#Demographic data
demo = BF %>% 
  select(-starts_with("Product")) %>%
  group_by(User_ID) %>%
  mutate(Purchase = sum(Purchase))

#5891 unique customers

demo = demo[!duplicated(demo$User_ID), ]
```
3. Summary statistics and Data Visualizations  
** Customer Demographics**  
* The distribution of gender and marital status  
```{r echo=TRUE, message=FALSE, warning=FALSE}
# Two way frequency table showing different combinations of customers using gender and marital status  
customer = table(demo$Gender, demo$Marital_Status)
colnames(customer) = c("Unmarried", "Married")
rownames(customer) = c("Female", "Male")

addmargins(customer)
addmargins(prop.table(customer))
```
The two-way frequency table shows 4 combinations of customers. There are 5891 distinct customers in total, and 2470 of them are unmarried males; 1755 are married males; 947 are unmarried females; 719 are married females.  
In this two-way frequency table, we can deduce that there are more unmarried customers (58%) than married (42%) and more male customers (72%) than female (28%). Therefore, in the following analyses regarding gender and marital status, we will focus on customers' average purchase amount instead of the sum purchase, because the sum purchase will easily be influenced by the number of people, which may cause a biased conclusion. 

** Distribution of purchase**
```{r echo=TRUE, message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(Purchase)) +
  geom_histogram(col = "black", fill = "orange") +
  scale_x_continuous(limits = c(0, 11000000)) +
  theme_minimal() +
  labs(x = "Purchase in Dollars", y = "Number of Customers", title = "Purchase Distribution")
```

** Purchase distribution by gender and city**
```{r message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(x = Purchase, fill = Gender)) +
  geom_histogram() +
  facet_grid(~City_Category) +
  scale_x_continuous(limits = c(0, 3000000)) +
  theme_minimal() +
  labs(x = "Purchase in Dollars", y = "Number of Customers", title = "Purchase Distribution by Gender and City")+
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
```

** Purchase distribution by occupation**
```{r message=FALSE, warning=FALSE}
demo_occ = demo %>%
  group_by(Occupation)

demo_occ %>%
  ggplot(aes(x = fct_infreq(Occupation), y = sum(Purchase), fill = Marital_Status)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  coord_flip() +
  labs(x = "Occupation", y = "Purchase in Dollars", title = "Purchase Distribution by Occupation")
```

** Purchase distribution by age**
```{r message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(x = Age, y = Purchase)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = "Age", y = "Purchase in Dollars", title = "Purchase Distribution by Age")
```

** Purchase distribution by gender**
```{r message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(x = Purchase, fill = Gender)) +
  geom_histogram() +
  scale_x_continuous(limits = c(0, 3000000)) +
  theme_minimal() +
  labs(x = "Purchase in Dollars", y = "Number of Customers", title = "Purchase Distribution by Gender")
```

** Purchase distribution by stay in city years**
```{r message=FALSE, warning=FALSE}
demo %>%
  ggplot(aes(x = Stay_In_Current_City_Years, y = Purchase)) +
  geom_boxplot()+
  theme_minimal() +
  labs(x = "Stay in Current City Years", y = "Purchase", title = "Purchase Distribution by Current City Years")
```

** Whatâ€™s the most popular product category?**
The product category 1 has three of the most popular products: 5, 1 and 8 
```{r, echo=TRUE, message=FALSE, warning=FALSE}
BF_prt = BF %>%
  group_by(Product_ID) %>%
  mutate(sumpp = sum(Purchase), avgpp = mean(Purchase))
BF_prt = BF_prt[-c(3:8)]
BF_prt%>%
  ggplot(aes(x = Product_Category_1))+
  geom_bar(aes(x = fct_infreq(as.factor(Product_Category_1))),fill = 'paleturquoise1')
```

4. Preliminary statistical analyses
```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Independent t-test
#Do men spend more money on Black Friday than women?
t.test(demo[demo$Gender == "M", ]$Purchase,
       demo[demo$Gender == "F", ]$Purchase,
       paired = FALSE,
       alternative = "greater")
```
The above two sample t-test has a very low p-value, showing that the null hypothesis is rejected. The null hypothesis in that men do not spend more money than women on Black Friday. 

```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Independent t-test
#Do unmarried customers spend more money on Black Friday than married?
t.test(demo[demo$Marital_Status == 0, ]$Purchase,
       demo[demo$Marital_Status == 1, ]$Purchase,
       paired = FALSE,
       alternative = "greater")
```
Once again, we have a low p-value (0.056), showing that we will reject the null hypothesis. The null hypothesis is that unmarried customers do not spend more than married customers.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Chi square test
#Is there an association between age and purchase?

#Creat purchase category
demo = demo %>% 
  mutate(purchase_category = cut(Purchase, breaks = c(-Inf, 234914, 512612, 1099005, Inf),
                                        labels = c("low", "middle", "high", "very high")))

#Create two-way frequency table
table(demo$Age, demo$purchase_category)

#Apply chi square test
chisq.test(table(demo$Age, demo$purchase_category))
```

We decided to use the Chi-Square test to determine association between age and purchase because the variables are continuous. The p-value is extremely low, thus we reject the null hypothesis. The null hypothesis is that there is no association between age and purchase.